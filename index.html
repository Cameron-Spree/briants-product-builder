<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Briants Product Builder</title>
    <meta name="description" content="Product creation tool for Briants WooCommerce store">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="/src/styles.css">
</head>

<body>

    <div id="app">

        <!-- ‚îÄ‚îÄ‚îÄ HEADER ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
        <header id="app-header">
            <div class="header-left">
                <div class="logo">
                    <span class="logo-icon">üì¶</span>
                    <h1>Briants <span class="accent">Product Builder</span></h1>
                </div>
            </div>
            <div class="header-center">
                <nav id="main-nav">
                    <button class="nav-btn active" data-view="upload">
                        <span class="nav-icon">üìÅ</span> Upload
                    </button>
                    <button class="nav-btn" data-view="workspace">
                        <span class="nav-icon">‚öôÔ∏è</span> Workspace
                    </button>
                    <button class="nav-btn" data-view="export">
                        <span class="nav-icon">üì§</span> Export
                    </button>
                </nav>
            </div>
            <div class="header-right">
                <div id="stats-bar" class="stats-bar">
                    <div class="stat">
                        <span class="stat-value" id="stat-total">0</span>
                        <span class="stat-label">Total</span>
                    </div>
                    <div class="stat">
                        <span class="stat-value stat-pending" id="stat-pending">0</span>
                        <span class="stat-label">Pending</span>
                    </div>
                    <div class="stat">
                        <span class="stat-value stat-complete" id="stat-complete">0</span>
                        <span class="stat-label">Done</span>
                    </div>
                </div>
                <button class="btn btn-sm btn-icon" id="theme-btn" title="Toggle Light/Dark Mode">‚òÄÔ∏è</button>
                <button class="btn btn-sm btn-icon" id="settings-btn" title="Settings">‚öôÔ∏è</button>
            </div>
        </header>

        <!-- ‚îÄ‚îÄ‚îÄ UPLOAD VIEW ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
        <div id="upload-view" class="view active">
            <div class="view-content centered">
                <div class="upload-card glass-panel">
                    <div class="upload-zone" id="upload-zone">
                        <div class="upload-icon">üìÑ</div>
                        <h2>Upload Product CSV</h2>
                        <p class="upload-hint">Drag & drop your CSV file here, or click to browse</p>
                        <p class="upload-format">Expected columns: <strong>SKU</strong>, <strong>Name</strong>,
                            <strong>Price</strong>
                        </p>
                        <input type="file" id="csv-input" accept=".csv,.txt" hidden>
                        <button class="btn btn-primary" id="browse-btn">Browse Files</button>
                    </div>
                    <div id="upload-progress" class="upload-progress hidden">
                        <div class="progress-bar">
                            <div class="progress-fill" id="progress-fill"></div>
                        </div>
                        <p id="upload-status" class="upload-status">Processing...</p>
                    </div>
                </div>

                <div id="upload-preview" class="upload-preview glass-panel hidden">
                    <h3>Preview</h3>
                    <div class="preview-table-wrap">
                        <table id="preview-table" class="data-table">
                            <thead>
                                <tr>
                                    <th>SKU</th>
                                    <th>Name</th>
                                    <th>Price</th>
                                </tr>
                            </thead>
                            <tbody id="preview-tbody"></tbody>
                        </table>
                    </div>
                    <div class="preview-actions">
                        <span id="preview-count" class="preview-count"></span>
                        <button class="btn btn-success" id="confirm-upload-btn">Confirm & Import</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- ‚îÄ‚îÄ‚îÄ WORKSPACE VIEW ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
        <div id="workspace-view" class="view">
            <div class="workspace-layout">

                <!-- Sidebar: Product Queue -->
                <aside id="product-sidebar" class="glass-panel">
                    <div class="sidebar-header">
                        <h3>Products</h3>
                        <div class="sidebar-filters">
                            <select id="status-filter" class="input-select">
                                <option value="all">All</option>
                                <option value="pending">Pending</option>
                                <option value="confirmed">Confirmed</option>
                                <option value="complete">Complete</option>
                            </select>
                        </div>
                    </div>
                    <div class="sidebar-search">
                        <input type="text" id="queue-search" class="input-text" placeholder="Search products...">
                        <button class="btn btn-sm btn-success" id="auto-scrape-all-btn"
                            style="margin-top: 8px; width: 100%; display: flex; justify-content: center; align-items: center; gap: 4px;"
                            title="Automatically search and scrape all pending products">ü§ñ Auto-Scrape All
                            Pending</button>
                    </div>
                    <div id="product-queue" class="product-queue"></div>
                </aside>

                <!-- Main: Product Editor -->
                <main id="product-editor" class="product-editor">
                    <div id="no-product-selected" class="empty-state">
                        <div class="empty-icon">üëà</div>
                        <h3>Select a product</h3>
                        <p>Choose a product from the sidebar to start editing</p>
                        <div style="margin-top: 2rem;">
                            <button class="btn btn-danger" id="clear-all-btn">üóëÔ∏è Clear Workspace (Start Fresh)</button>
                        </div>
                    </div>

                    <div id="editor-panel" class="editor-panel hidden">

                        <!-- Product Header -->
                        <div class="editor-header glass-panel">
                            <div class="editor-header-info">
                                <span class="sku-badge" id="editor-sku"></span>
                                <h2 id="editor-name"></h2>
                                <span class="price-tag" id="editor-price"></span>
                            </div>
                            <div class="editor-header-actions">
                                <select id="editor-status" class="input-select status-select">
                                    <option value="pending">‚è≥ Pending</option>
                                    <option value="searching">üîç Searching</option>
                                    <option value="confirmed">‚úÖ Confirmed</option>
                                    <option value="complete">üéâ Complete</option>
                                </select>
                                <button class="btn btn-sm btn-save" id="save-product-btn">üíæ Save</button>
                                <button class="btn btn-sm btn-ai" id="ai-generate-btn"
                                    title="Fill empty fields with Gemini AI">ü§ñ AI Fill</button>
                            </div>
                        </div>

                        <!-- Section: Product Type & Variations -->
                        <div class="editor-section glass-panel">
                            <div class="section-header" data-toggle="type-section">
                                <h3>üì¶ Product Type & Variations</h3>
                                <span class="toggle-icon">‚ñº</span>
                            </div>
                            <div id="type-section" class="section-body">
                                <div class="input-group">
                                    <label class="checkbox-label">
                                        <input type="checkbox" id="is-variation-checkbox">
                                        This product is a Variation of another product
                                    </label>
                                </div>
                                <div id="variation-setup-container" class="hidden"
                                    style="margin-top: 1rem; border-top: 1px solid var(--border-color); padding-top: 1rem;">

                                    <div class="input-group">
                                        <label>Parent Product</label>
                                        <select id="parent-product-select" class="input-select">
                                            <option value="">--- Create New Parent ---</option>
                                            <!-- Existing parents injected here -->
                                        </select>
                                    </div>

                                    <div id="new-parent-fields" class="sub-panel"
                                        style="background: rgba(0,0,0,0.05); padding: 1rem; border-radius: 4px; margin-bottom: 1rem;">
                                        <div class="input-group">
                                            <label>New Parent Name</label>
                                            <input type="text" id="new-parent-name" class="input-text"
                                                placeholder="e.g. Closeboard Fence Panel">
                                        </div>
                                        <div class="input-group">
                                            <label>New Parent SKU</label>
                                            <input type="text" id="new-parent-sku" class="input-text"
                                                placeholder="e.g. VAR-FENCE-01">
                                        </div>
                                        <div class="input-group">
                                            <label>Global Attribute Name <span class="input-hint">(e.g., Size,
                                                    Color)</span></label>
                                            <input type="text" id="global-attribute-name" class="input-text"
                                                placeholder="Size">
                                        </div>
                                    </div>

                                    <div class="input-group border-top" style="padding-top: 1rem;">
                                        <label>This Variation's Option Value <span class="input-hint">(e.g.,
                                                6ft)</span></label>
                                        <input type="text" id="variation-value" class="input-text" placeholder="6ft">
                                    </div>

                                </div>

                                <!-- Container for Parents to see their children -->
                                <div id="parent-setup-container" class="hidden"
                                    style="margin-top: 1rem; border-top: 1px solid var(--border-color); padding-top: 1rem;">
                                    <label
                                        style="font-weight: 600; display: block; margin-bottom: 0.5rem; color: var(--text-color);">Variations
                                        assigned to this product:</label>
                                    <div id="parent-variations-list"
                                        style="display: flex; flex-direction: column; gap: 6px;">
                                        <!-- Variations will be injected here by JS -->
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Section: Search & Confirm -->
                        <div class="editor-section glass-panel">
                            <div class="section-header" data-toggle="search-section">
                                <h3>üîç Search & Confirm Product</h3>
                                <span class="toggle-icon">‚ñº</span>
                            </div>
                            <div id="search-section" class="section-body">
                                <div class="search-actions">
                                    <button class="btn btn-primary" id="google-search-btn">Search Google</button>
                                    <button class="btn btn-success" id="auto-search-btn">ü§ñ Auto-Search & Fill</button>
                                    <span class="search-hint">Finds and scrapes automatically</span>
                                </div>
                                <div class="input-group">
                                    <label>Confirmed Product URL</label>
                                    <input type="url" id="confirmed-url" class="input-text" placeholder="https://...">
                                    <button class="btn btn-sm btn-secondary" id="scrape-btn">Scrape Product
                                        Info</button>
                                </div>
                                <div id="scrape-status" class="scrape-status hidden"></div>

                                <!-- Batch URL Paste -->
                                <div
                                    style="margin-top: 16px; border-top: 1px solid var(--border-subtle); padding-top: 16px;">
                                    <label
                                        style="font-size: 0.8rem; font-weight: 600; color: var(--text-secondary); text-transform: uppercase; letter-spacing: 0.03em; display: block; margin-bottom: 6px;">Batch
                                        Paste URLs</label>
                                    <textarea id="batch-urls" class="input-textarea" rows="4"
                                        placeholder="Paste one URL per line. Each URL will be matched to the next pending product."></textarea>
                                    <button class="btn btn-sm btn-primary" id="batch-assign-btn"
                                        style="margin-top: 8px;">üìã Assign URLs to Pending Products</button>
                                    <span class="input-hint">Paste URLs (one per line) to assign them to pending
                                        products in order, then run Auto-Scrape All.</span>
                                </div>
                            </div>
                        </div>

                        <!-- Section: Descriptions -->
                        <div class="editor-section glass-panel">
                            <div class="section-header" data-toggle="desc-section">
                                <h3>üìù Descriptions</h3>
                                <span class="toggle-icon">‚ñº</span>
                            </div>
                            <div id="desc-section" class="section-body">
                                <div class="input-group">
                                    <label>Short Description <span class="char-count"
                                            id="short-desc-count">0</span></label>
                                    <textarea id="short-desc" class="input-textarea" rows="3"
                                        placeholder="A couple of sentences describing the product..."></textarea>
                                </div>
                                <div class="input-group">
                                    <label>Long Description</label>
                                    <textarea id="long-desc" class="input-textarea" rows="8"
                                        placeholder="Detailed product description with all relevant information..."></textarea>
                                </div>
                                <div class="input-group">
                                    <label>Features (HTML) <span class="format-hint">&lt;ul&gt;&lt;li&gt;
                                            format</span></label>
                                    <textarea id="features-html" class="input-textarea code" rows="8"
                                        placeholder="<ul>&#10;  <li>Feature one</li>&#10;  <li>Feature two</li>&#10;</ul>"></textarea>
                                    <div id="features-preview" class="features-preview"></div>
                                </div>
                            </div>
                        </div>

                        <!-- Section: Categories -->
                        <div class="editor-section glass-panel">
                            <div class="section-header" data-toggle="cat-section">
                                <h3>üè∑Ô∏è Categories</h3>
                                <span class="toggle-icon">‚ñº</span>
                            </div>
                            <div id="cat-section" class="section-body">
                                <div class="suggested-cats">
                                    <h4>Suggested Categories</h4>
                                    <div id="suggested-categories" class="category-chips"></div>
                                </div>
                                <div class="input-group">
                                    <label>Selected Categories</label>
                                    <div id="selected-categories" class="selected-categories"></div>
                                </div>
                                <div class="input-group">
                                    <label>Browse All Categories</label>
                                    <input type="text" id="cat-search" class="input-text"
                                        placeholder="Search categories...">
                                    <div id="all-categories" class="category-list"></div>
                                </div>
                            </div>
                        </div>

                        <!-- Section: Images -->
                        <div class="editor-section glass-panel">
                            <div class="section-header" data-toggle="img-section">
                                <h3>üñºÔ∏è Images</h3>
                                <span class="toggle-icon">‚ñº</span>
                            </div>
                            <div id="img-section" class="section-body">
                                <div id="image-gallery" class="image-gallery"></div>
                                <div class="input-group">
                                    <label>Add Image URL</label>
                                    <div class="url-input-row">
                                        <input type="url" id="add-image-url" class="input-text"
                                            placeholder="https://...image.jpg">
                                        <button class="btn btn-sm btn-secondary" id="add-image-btn">Add</button>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Section: Source Links -->
                        <div class="editor-section glass-panel">
                            <div class="section-header" data-toggle="source-section">
                                <h3>üîó Source Links</h3>
                                <span class="toggle-icon">‚ñº</span>
                            </div>
                            <div id="source-section" class="section-body">
                                <div id="source-links" class="source-links"></div>
                                <div class="input-group">
                                    <div class="url-input-row">
                                        <input type="url" id="add-source-url" class="input-text"
                                            placeholder="https://...">
                                        <button class="btn btn-sm btn-secondary" id="add-source-btn">Add Link</button>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Section: Notes -->
                        <div class="editor-section glass-panel">
                            <div class="section-header" data-toggle="notes-section">
                                <h3>üìã Notes</h3>
                                <span class="toggle-icon">‚ñº</span>
                            </div>
                            <div id="notes-section" class="section-body">
                                <textarea id="product-notes" class="input-textarea" rows="3"
                                    placeholder="Any notes about this product..."></textarea>
                            </div>
                        </div>

                    </div>
                </main>
            </div>
        </div>

        <!-- ‚îÄ‚îÄ‚îÄ EXPORT VIEW ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
        <div id="export-view" class="view">
            <div class="view-content centered">
                <div class="export-card glass-panel">
                    <h2>üì§ Export to WooCommerce</h2>
                    <p class="export-hint">Generate a WooCommerce-compatible CSV file for all completed products.</p>

                    <div class="export-stats">
                        <div class="export-stat">
                            <span class="export-stat-value" id="export-total">0</span>
                            <span class="export-stat-label">Total Products</span>
                        </div>
                        <div class="export-stat">
                            <span class="export-stat-value export-ready" id="export-complete">0</span>
                            <span class="export-stat-label">Ready to Export</span>
                        </div>
                        <div class="export-stat">
                            <span class="export-stat-value export-remaining" id="export-remaining">0</span>
                            <span class="export-stat-label">Still Pending</span>
                        </div>
                    </div>

                    <div class="input-group">
                        <label>Website Domain</label>
                        <input type="text" id="export-domain" class="input-text" placeholder="briantsofrisborough.co.uk"
                            value="briantsofrisborough.co.uk">
                        <span class="input-hint">Used for image URLs in the CSV</span>
                    </div>

                    <div class="export-actions">
                        <button class="btn btn-primary btn-lg" id="export-csv-btn">
                            üì• Download WooCommerce CSV
                        </button>
                        <button class="btn btn-secondary" id="export-all-btn">
                            Export All (including incomplete)
                        </button>
                    </div>

                    <div class="glass-panel" style="margin-top: 24px; padding: 24px; text-align: center;">
                        <h3 style="margin-bottom: 12px;">Image Export</h3>
                        <p style="color: var(--text-secondary); margin-bottom: 20px; font-size: 0.9rem;">
                            Download a ZIP file containing all your approved product images. These can be uploaded
                            directly to WordPress media library.
                        </p>
                        <button class="btn btn-success btn-lg" id="export-images-btn">
                            üì¶ Download Images (ZIP)
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- ‚îÄ‚îÄ‚îÄ SETTINGS MODAL ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
        <div id="settings-modal" class="modal-overlay hidden">
            <div class="glass-panel modal-panel">
                <div class="modal-header">
                    <h3>‚öôÔ∏è Settings</h3>
                    <button class="btn btn-sm btn-icon" id="close-settings">‚úï</button>
                </div>
                <div class="modal-body">
                    <div class="input-group">
                        <label>Gemini API Key</label>
                        <input type="password" id="gemini-api-key" class="input-text"
                            placeholder="Paste your Gemini API key here">
                        <span class="input-hint">Get a free key at <a href="https://aistudio.google.com/apikey"
                                target="_blank">aistudio.google.com/apikey</a></span>
                    </div>

                    <hr style="border: none; border-top: 1px solid var(--border-subtle); margin: 16px 0;">

                    <div class="input-group">
                        <label>Google Custom Search API Key <span class="input-hint"
                                style="text-transform:none;">(optional ‚Äî 100 free/day)</span></label>
                        <input type="password" id="google-api-key" class="input-text"
                            placeholder="Paste your Google API key here">
                        <span class="input-hint">Get a free key at <a
                                href="https://console.cloud.google.com/apis/credentials" target="_blank">Google Cloud
                                Console</a></span>
                    </div>
                    <div class="input-group">
                        <label>Search Engine ID (cx) <span class="input-hint" style="text-transform:none;">(from
                                Programmable Search)</span></label>
                        <input type="text" id="google-cse-id" class="input-text" placeholder="e.g. a1b2c3d4e5f6g7h8i">
                        <span class="input-hint">Create at <a href="https://programmablesearchengine.google.com"
                                target="_blank">programmablesearchengine.google.com</a></span>
                    </div>

                    <div id="settings-status" class="settings-status"></div>
                    <button class="btn btn-primary" id="save-settings-btn">üíæ Save Settings</button>
                </div>
            </div>
        </div>

        <!-- ‚îÄ‚îÄ‚îÄ TOAST CONTAINER ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
        <div id="toast-container" class="toast-container"></div>

    </div>

    <script type="module" src="/src/main.js"></script>
</body>

</html>